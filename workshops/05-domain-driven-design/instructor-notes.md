# 第5回 ドメイン駆動設計（DDD） — 講師補助資料

## この回の核心

> 「ビジネスの言葉でコードを書くことが、最も強力な設計手法」

知識レベルA（実務経験必須）の回。DDDは概念が広く抽象度も高いため、「戦略的設計の概要 → 戦術的設計の具体コード」の順で地に足をつけた説明を心がける。

## 講師の事前準備チェックリスト

- [ ] Evans本 or 成瀬本を再読し、自分の言葉で集約・値オブジェクト・エンティティを説明できるようにする
- [ ] 実務でユビキタス言語の策定に苦労した/成功した体験を1つ準備する
- [ ] 集約の境界を間違えて苦労した実体験を1つ準備する
- [ ] コンテキストマップの例を自社 or 一般的なECの例で描けるようにする
- [ ] 第1回（DIP）、第3回（データモデリング）、第4回（Repository, Factory）との接続を整理する

## 時間配分ガイド

| パート | 配分 | 注意点 |
|--------|------|--------|
| 前回振り返り | 5分 | Repositoryパターンの復習 |
| DDDの概要と背景 | 15分 | Evans本の歴史より「DDDが解決する問題」に集中 |
| **戦略的設計** | **30分** | ユビキタス言語とBounded Contextが肝 |
| **戦術的設計** | **40分** | エンティティ・値オブジェクト・集約にじっくり時間を |
| 休憩 | 10分 | |
| ディスカッション | 20分 | 集約の境界の議論が最も盛り上がる |
| Q&A + 次回予告 | 10分 | |

## 各トピックの教え方のポイント

### ユビキタス言語
- 「開発者が『user_order_record』と呼んでいるものを、ビジネスサイドは『注文』と呼ぶ。このズレが設計の歪みを生む」
- コード上の命名がそのままユビキタス言語になるべき、という原則を強調
- **実演:** 参加者に「自分のプロジェクトで、開発者とビジネスサイドで呼び方が違うものは？」と聞く

### 境界づけられたコンテキスト
- READMEのコンテキストマップ図を使いながら説明
- 「同じ『商品』でもカタログと在庫で意味が違う」が最も伝わりやすい例
- ACL（腐敗防止層）は第4回のAdapterパターンの応用であることを示す
- **注意:** コンテキスト間の関係パターン（共有カーネル、顧客/供給者等）は深入りしすぎない。名前と概要だけでOK

### エンティティ vs 値オブジェクト
- **「同一性で比較する」vs「値で比較する」** が核心
- 例:「田中太郎さんが名前を田中花子に変えても同一人物（エンティティ）」「1000円は別の1000円と区別しない（値オブジェクト）」
- TypeScriptコードで `equals()` の実装を見せると具体的になる

### 集約
- **この回で最も理解が難しく、最も議論になるポイント**
- 「集約は小さく保つ」原則を繰り返し強調する
- Order集約の例: Order（集約ルート）→ OrderItem（内部エンティティ）→ Money（値オブジェクト）
- **問いかけ:** 「Order集約にCustomer情報を含めるべきか？含めると何が問題か？」

### ドメインイベント
- 「OrderPlaced」「PaymentCompleted」のように過去形で命名
- 第9回（イベント駆動）への重要な伏線。「ここで学んだドメインイベントがサービス間通信の基盤になる」と予告

## 想定される質問と回答例

| 質問 | 回答の方向性 |
|------|-------------|
| 「DDDは全プロジェクトに適用すべき？」 | 「ビジネスロジックが複雑な場合に真価を発揮する。CRUDが中心の管理画面にはオーバーキル。ドメインの複雑さに応じて適用度を変える」 |
| 「集約をどのくらいの大きさにすべきか分からない」 | 「1つのトランザクションで整合性を保つ必要がある範囲。迷ったら小さく作って、後から必要に応じて広げるほうが安全」 |
| 「値オブジェクトのimmutableはコスト高くない？」 | 「JavaScriptのプリミティブ（string, number）も不変。同じ感覚で。パフォーマンス問題は実際に計測してから考える」 |
| 「DBのテーブルとドメインモデルは1対1？」 | 「必ずしも一致しない。集約を1テーブルにマッピングするとは限らない。第6回のクリーンアーキテクチャでこの分離をさらに詳しく扱う」 |

## 次回（第6回 クリーンアーキテクチャ）への橋渡し

- 「今日設計したドメインモデルを、アプリケーション全体のどこに置くか。外部（DB、API、UI）とどう接続するか。それが次回のテーマです」
- 「DDDの戦術的パターンは『ドメイン層』に置かれ、それを中心にアプリケーション全体を構造化するのがクリーンアーキテクチャです」
