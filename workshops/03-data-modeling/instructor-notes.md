# 第3回 データモデリング — 講師補助資料

## この回の核心

> 「良いデータモデルは、ビジネスの構造を正しく反映している」

「いきなりテーブルを作る」のではなく、概念→論理→物理の3段階を踏むプロセスを体験させることが最大の目的。

## 講師の事前準備チェックリスト

- [ ] ER図をホワイトボードで手書きする練習（概念モデルレベル）
- [ ] 図書管理システムの3段階モデリングを自分で一通り実演できる状態にする
- [ ] ナチュラルキー vs サロゲートキーの判断基準を自分の言葉で整理する
- [ ] ソフトデリートの採用/不採用それぞれの実務事例を1つずつ準備する
- [ ] dbdiagram.io または同等ツールの操作に慣れておく

## 時間配分ガイド

| パート | 配分 | 注意点 |
|--------|------|--------|
| 前回振り返り | 5分 | 正規化の3段階を1人に聞く |
| データモデリングとは | 10分 | 「なぜいきなりCREATE TABLEではダメか」を強調 |
| 概念データモデル | 20分 | ER図の記法は最小限に。ビジネスの言葉が大事 |
| 論理データモデル | 20分 | M:N分解、主キー選定がポイント |
| 物理データモデル | 20分 | 第2回の正規化・インデックスとの接続を明示 |
| **モデリングワークスルー** | **30分** | **この回の目玉。** 参加者を巻き込みながら進める |
| 休憩 | 10分 | |
| ディスカッション + Q&A | 20分 | |

## 各トピックの教え方のポイント

### 概念モデル
- 「技術の言葉を使わない」ことを強調。テーブルやカラムではなく「もの」と「関係」
- 参加者に「図書管理システムに登場する『もの』を挙げてください」と問いかけ、ホワイトボードに列挙する
- カーディナリティは「1人の著者は何冊の本を書けるか？」のように日本語の問いで導く

### 論理モデル
- M:N分解は「なぜ中間テーブルが必要か」を図で示す
- **ナチュラルキー vs サロゲートキー** は議論が盛り上がるポイント。ISBN、メールアドレスなどのナチュラルキーが変更される可能性を議論させる
- NULL許容の判断:「この値が無い状態はビジネス上あり得るか？」

### 物理モデル
- Prisma schema 形式で見せると、参加者のTypeScript経験と結びつく
- `created_at` / `updated_at` は「どのテーブルにも入れるべきか？」と問いかける
- ソフトデリート:「便利だが、全クエリにWHERE deleted_at IS NULLが必要になる」

### モデリングワークスルー
- **講師が全部やるのではなく、参加者に考えさせながら進める**
- 手順: (1)要件を読む → (2)「どんな『もの』がある？」 → (3)「関係は？」 → (4)属性を足す → (5)M:N分解 → (6)Prisma化
- 完璧でなくてよい。「後から修正できる」ことを体験させる

## 想定される質問と回答例

| 質問 | 回答の方向性 |
|------|-------------|
| 「概念モデルは実務で本当にやりますか？」 | 「形式的にやる必要はないが、ホワイトボードでエンティティと関係を描く行為は概念モデリングそのもの。チームの認識合わせに非常に有効」 |
| 「UUID vs auto incrementどちらがいい？」 | 「UUIDは分散環境で衝突しない利点。auto incrementはシンプルで可読性が高い。マイクロサービスに分割する可能性があるならUUID推奨」 |
| 「テーブル名は英語の複数形にすべき？」 | 「チーム・プロジェクトの規約に従う。大事なのは一貫性。Prismaはモデル名が単数、テーブル名が複数という慣習がある」 |
| 「第5回のDDDとデータモデリングは何が違う？」 | 「データモデリングは『データの構造』に注目。DDDは『ビジネスの振る舞い』にも注目。第5回ではここに値オブジェクトや集約の概念が加わる」 |

## 次回（第4回 デザインパターン）への橋渡し

- 「今日は『データの構造化』を学びました。次回はコードを書くときに使える『設計の型』を学びます」
- 「データモデリングで学んだ『ビジネスの構造をモデルで表現する』という発想は、第5回DDDでさらに深掘りします」
