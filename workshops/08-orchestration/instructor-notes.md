# 第8回 オーケストレーション — 講師補助資料

## この回の核心

> 「インフラの自動化と標準化が、サービスのスケーラビリティを支える」

知識レベルA（実務経験必須）。Docker/K8s/CI/CDと範囲が広い。全部を深堀りするのは不可能なので、「なぜ必要か」と「概念の理解」に重点を置き、詳細な操作は課題に委ねる。

## 講師の事前準備チェックリスト

- [ ] Node.jsアプリのDockerfile（マルチステージビルド）を手元でビルド・実行できる状態にする
- [ ] docker-compose でアプリ+DBを立ち上げるデモを準備する
- [ ] Kubernetes の概念図（Pod / Deployment / Service / Ingress の関係）を描けるようにする
- [ ] CI/CDパイプラインを実際に構築した経験からの学びを2〜3個用意する
- [ ] Blue-Green / カナリアリリースの具体的な失敗談・成功談を1つ準備する
- [ ] （可能なら）minikube or kind でローカルK8s環境を準備しデモできるようにする

## 時間配分ガイド

| パート | 配分 | 注意点 |
|--------|------|--------|
| 前回振り返り | 5分 | マイクロサービスの分割原則を確認 |
| なぜオーケストレーションが必要か | 10分 | 手動運用の辛さを体験談で |
| **コンテナ技術（Docker）** | **25分** | Dockerfile ライブコーディングが効果的 |
| **K8s** | **30分** | 概念に集中。YAMLの詳細暗記は不要と伝える |
| サービスメッシュ | 15分 | 概要のみ。Istio/Linkerdは名前を紹介する程度 |
| **CI/CD** | **20分** | GitHub Actionsの例で具体的に |
| 休憩 | 10分 | |
| ディスカッション + Q&A | 20分 | |

## 各トピックの教え方のポイント

### Docker
- 「コンテナ = 超軽量な仮想マシン」は不正確だが入口としてはOK。正確には「プロセスの隔離」
- **マルチステージビルドは必ず扱う。** ビルドステージとランナーステージでイメージサイズが劇的に変わることを数字で見せる（例: 1.2GB → 150MB）
- `USER node` でrootを避ける理由も一言触れる（セキュリティ）

### Docker Compose
- 「ローカル開発環境をコード化できる」メリットを強調
- `docker compose up` 一発でアプリ+DB+Redisが立ち上がるデモが効果的

### Kubernetes
- **概念図を最初に示し、全体像を掴ませてからYAMLに入る**
- Pod → Deployment → Service → Ingress の順に、「なぜ抽象化が必要か」を説明
- Pod:「コンテナを包む最小単位」
- Deployment:「Podの望ましい状態を宣言する。K8sが勝手にその状態を維持する」
- Service:「Pod群への安定したアクセスポイント」
- **YAMLの暗記は不要** と明言する。「構造を理解していれば、リファレンスを見ながら書ける」

### サービスメッシュ
- 「サービス間通信のインフラを自動化してくれるもの」程度の理解でOK
- サイドカープロキシの図を描いて概念を示す
- 「小規模では不要。サービス数が数十〜になったときの選択肢」

### CI/CD
- GitHub Actions のYAMLをそのまま見せながら「何が起きているか」を説明
- デプロイ戦略（ローリング / Blue-Green / カナリア）は図を描いて比較
- **「どれを選ぶか」は一概に言えない** ことを強調。リスク許容度と運用コストのトレードオフ

## 想定される質問と回答例

| 質問 | 回答の方向性 |
|------|-------------|
| 「Kubernetesは全エンジニアが学ぶべき？」 | 「概念の理解は全員にとって有益。YAMLの詳細やクラスタ運用はプラットフォームチームに任せる選択もある。ただし『何ができるか』は知っておくべき」 |
| 「サーバーレス（Lambda等）との使い分けは？」 | 「ステートレスで短時間の処理はサーバーレス向き。常駐プロセスや複雑なオーケストレーションはコンテナ向き。両方使うこともある」 |
| 「CI/CDのパイプラインが遅いのですが」 | 「キャッシュの活用、並列実行、テストの分割実行、Docker層のキャッシュなどが改善ポイント。テスト自体を速くすることも重要」 |
| 「ECS / Cloud Run / Fly.io じゃダメ？」 | 「K8sの抽象化サービスとして非常に良い選択肢。K8sの概念を理解した上で、マネージドサービスで運用コストを下げるのは合理的」 |

## デモ・実演のアイデア

1. **Dockerfile ライブコーディング:** Node.jsアプリを目の前でコンテナ化
2. **docker compose up デモ:** アプリ+PostgreSQLを一発起動
3. **（可能なら）K8s デモ:** minikube で Deployment を作成し、`kubectl scale` でスケーリングを見せる

## 次回（第9回 イベント駆動）への橋渡し

- 「今日は『サービスをどう運用するか』を学びました。次回は『サービス間をどうつなぐか』の非同期アプローチを学びます」
- 「第7回で同期通信（REST / gRPC）を扱いました。次回はもう一方の柱である非同期通信（メッセージング、イベント駆動）を深堀りします」
