# 第4回 デザインパターン — 講師補助資料

## この回の核心

> 「パターンは道具。問題に合わせて選択し、過剰適用を避ける」

GoF 23パターンを網羅するのではなく、実務で使う6パターンに絞る。「なぜこのパターンが必要か」「使わないとどうなるか」を対比で教える。

## 講師の事前準備チェックリスト

- [ ] 紹介する6パターン（Factory, Builder, Adapter, Facade, Strategy, Observer, Repository）の TypeScriptコード例を動作確認する
- [ ] 各パターンの「使いすぎた失敗例」または「使わなくて困った例」を1つずつ用意する
- [ ] Express / NestJS で使われているパターンを2〜3個特定しておく（ミドルウェア＝Chain of Responsibility、DI＝Factory等）
- [ ] 第1回のSOLID原則との関連（特にOCPとStrategy、DIPとRepository）を説明できるよう整理する

## 時間配分ガイド

| パート | 配分 | 注意点 |
|--------|------|--------|
| 前回振り返り | 5分 | データモデリングの3段階を確認 |
| デザインパターンとは | 10分 | 「パターン病」の警告を最初に伝える |
| 生成パターン（Factory, Builder） | 20分 | Factory に重点。Builder はメソッドチェインの例で軽く |
| 構造パターン（Adapter, Facade） | 20分 | Adapter に重点。外部APIラッパーが分かりやすい |
| **振る舞いパターン（Strategy, Observer, Repository）** | **30分** | **Repository は第5〜6回に直結するため最も丁寧に** |
| パターンの適用判断 | 15分 | フレームワーク内のパターンを示すと「実は知ってた」になる |
| 休憩 | 10分 | |
| ディスカッション + Q&A | 20分 | |

## 各パターンの教え方のポイント

### Factory Method
- 「if文でオブジェクト生成を切り替えている」コードを見せて → Factoryで解消する流れ
- 第1回のOCPと接続:「新しい種類の追加でif文を書き換えなくて済む」

### Builder
- 「コンストラクタの引数が5個以上あるクラス」を見せて → Builderで改善
- TypeScriptでは Options パターン（オブジェクトリテラル）で事足りる場面も多い。使い分けを示す

### Adapter
- 「外部決済API を自社の interface に合わせる」例が実務に一番近い
- 第6回のクリーンアーキテクチャで再登場することを予告

### Facade
- 「注文処理で在庫確認 → 決済 → 配送手配を1つのメソッドで」
- Service クラスとの違い:「Facade は既存サブシステムの窓口。新しいロジックは持たない」

### Strategy
- 第1回のOCP例（割引計算）をそのまま発展させると一貫性がある
- 「TypeScriptでは関数を渡すだけでStrategy相当になる」ことも示す

### Observer
- Node.js の EventEmitter が Observer パターンの実装であることを示す
- 第9回（イベント駆動）への伏線として「サービス間のイベント通知」に触れる

### Repository
- **この回で最も丁寧に扱う。** 第5回DDD、第6回クリーンアーキテクチャの土台
- InMemoryRepository と PrismaRepository の切り替えで依存性逆転を体感させる
- テストでの利点を実演:「DBなしでユースケースのテストが書ける」

## 想定される質問と回答例

| 質問 | 回答の方向性 |
|------|-------------|
| 「GoFの23パターン全部覚えるべき？」 | 「実務で頻出するのは今日扱った6〜7パターン。残りは名前だけ知っていて、必要になったら調べるスタンスでOK」 |
| 「関数型プログラミングでもパターンは使う？」 | 「Strategy＝高階関数、Observer＝コールバック/ストリーム。名前が違うだけで概念は活きる」 |
| 「パターンを使うタイミングがわからない」 | 「まず愚直に書いてみて、重複や変更しにくさを感じたときにパターンを検討する。最初からパターンを当てはめようとしない」 |
| 「Singleton は使わないの？」 | 「Node.jsのモジュールシステム自体がシングルトン的。明示的にSingletonパターンを書く必要はほぼない」 |

## 次回（第5回 DDD）への橋渡し

- 「今日学んだRepository、Factory、Strategyは、次回のDDDで実際のドメインモデルに組み込んで使います」
- 「デザインパターンが『コードレベルの型』なら、DDDは『ビジネスの構造化の型』。スケールが一段上がります」
